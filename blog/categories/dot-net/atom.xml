<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[.NET | Scott Smith]]></title>
  <link href="http://scottksmith.com/blog/categories/dot-net/atom.xml" rel="self"/>
  <link href="http://scottksmith.com/"/>
  <updated>2017-04-01T19:09:20-07:00</updated>
  <id>http://scottksmith.com/</id>
  <author>
    <name><![CDATA[Scott Smith]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Algolia Real Time Search With ASP.NET MVC &amp; Windows Phone 8.1]]></title>
    <link href="http://scottksmith.com/blog/2015/04/04/algolia-real-time-search-with-asp-dot-net-mvc-and-windows-phone-8-dot-1/"/>
    <updated>2015-04-04T20:11:00-07:00</updated>
    <id>http://scottksmith.com/blog/2015/04/04/algolia-real-time-search-with-asp-dot-net-mvc-and-windows-phone-8-dot-1</id>
    <content type="html"><![CDATA[<p>In this article, we are going to explore how to easily add Algolia search to a Windows Phone 8.1 application with an ASP.NET MVC backend. To do this, we will take advantage of Algolia's <a href="https://github.com/algolia/algoliasearch-client-csharp">C# client</a> to add indexing capabilities to the ASP.NET MVC application and search capabilities to the Windows Phone application.</p>

<p>The application we will be building is called PackageTrack. It is a simple web application where a user can create, read, update, and delete packages they like and use. The web application will be capable of managing the package information, indexing that data with Algolia, and providing a simple REST API for the data. We will also create a Windows Phone application with an auto suggest search box hooked into the Algolia search service to provide search results. Users will then be able to select one of the search results and have that information shown by requesting the data from the web application API.</p>

<h2>Prerequisites</h2>

<p>In order to follow along well, it will be helpful to share versions of tooling, operating system, and technology used for the tutorial. You will need to use (at the very least) Visual Studio 2013 with update 4. Also, in order to develop Windows Phone 8.1 applications, you will need to be developing on Windows 8 or greater. Finally, the application is being built using .NET framework 4.5.</p>

<h2>Create a new ASP.NET Web Application</h2>

<p>With Visual Studio running, create a new solution and choose an ASP.NET Web Application for your initial project. If you want to follow along exactly, name your solution <code>PackageTrack</code> and your project <code>PackageTrack.Web</code>.</p>

<p><img src="/images/algolia_csharp_01.png" alt="Screenshot 01" /></p>

<p>To keep this tutorial simple, change the authentication to <code>No Authentication</code>.</p>

<p><img src="/images/algolia_csharp_02.png" alt="Screenshot 02" /></p>

<p>You will also want to make sure MVC and Web API are selected.</p>

<p><img src="/images/algolia_csharp_03.png" alt="Screenshot 03" /></p>

<h2>Install necessary NuGet packages</h2>

<p>This application requires two new packages in order to work.</p>

<p><strong>Entity Framework</strong></p>

<p>Install the Entity Framework package. The version used in this tutorial is 6.1.3.</p>

<p><code>tcsh
PM&gt; Install-Package EntityFramework
</code></p>

<p><strong>Algolia Search</strong></p>

<p>Install the Algolia Search package. The version used in this tutorial is 3.0.5.</p>

<p><code>tcsh
PM&gt; Install-Package Algolia.Search
</code></p>

<p>Finally, we need to update all installed packages to make sure we are using the latest libraries and scripts. You can do this by right clicking the web project in Solution Explore and choosing <code>Manage NuGet Packages...</code>.</p>

<h2>Cleanup</h2>

<p>Now that we have our packages installed and updated, we need to perform a little cleanup in our project.</p>

<p>First, let's delete the Home Controller, <code>HomeController.cs</code>, and the <code>Home</code> directory within <code>Views</code>. We are removing the controller and its views because we will be creating our own later.</p>

<h2>Update our layout</h2>

<p>Our layout needs a little updating to improve the look and feel a bit. Update <code>\Vieews\Shared\_Layout.cshtml</code> with the following.</p>

<p>```html
&lt;!DOCTYPE html>
<html>
<head></p>

<pre><code>&lt;meta charset="utf-8" /&gt;
&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
&lt;title&gt;Package Track&lt;/title&gt;
@Styles.Render("~/Content/css")
@Scripts.Render("~/bundles/modernizr")
</code></pre>

<p></head>
<body></p>

<pre><code>&lt;div class="navbar navbar-inverse navbar-fixed-top"&gt;
    &lt;div class="container"&gt;
        &lt;div class="navbar-header"&gt;
            @Html.ActionLink("Package Track", "Index", "Home", new { area = "" }, new { @class = "navbar-brand" })
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class="container body-content"&gt;
    @RenderBody()
    &lt;hr /&gt;
    &lt;footer&gt;
        &lt;p&gt;&amp;copy; @DateTime.Now.Year - &lt;a href="https://www.algolia.com/" target="_blank"&gt;Algolia&lt;/a&gt;&lt;/p&gt;
    &lt;/footer&gt;
&lt;/div&gt;

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")
@RenderSection("scripts", required: false)
</code></pre>

<p></body>
</html>
```</p>

<h2>Entity Framework and Database</h2>

<p>We are now ready to create our model and DbContext in order to take advantage of Entity Framework. What we will do is a create a simple model to represent our package that we want to store in the database. After that, we will create our DbContext which will allow us to easily add, remove, update, and more on our packages stored in the database.</p>

<p>By default, the project is setup to use a local MDF database. You are welcome to change it but for simplicity this tutorial will not.</p>

<p>To create our package model, create a new file named <code>Package.cs</code> inside the <code>Models</code> directory. Update the created class to look like the following.</p>

<p>```c#
public class Package
{</p>

<pre><code>public int Id { get; set; }
public string Name { get; set; }
public string Link { get; set; }
public int Count { get; set; }
</code></pre>

<p>}
```</p>

<p>Next, we need to create our DbContext. To do this, create a new directory called <code>Data</code> at the root of the project. Then create a new file named <code>PackageTrackContext.cs</code> inside this new directory. Update the code to the following.</p>

<p>```c#
using PackageTrack.Web.Models;
using System;
using System.Collections.Generic;
using System.Data.Entity;
using System.Linq;
using System.Web;</p>

<p>namespace PackageTrack.Web.Data
{</p>

<pre><code>public class PackageTrackDbContext : DbContext
{
    public DbSet&lt;Package&gt; Packages { get; set; }
}
</code></pre>

<p>}
```</p>

<p>Before moving on, be sure to build your solution. This will be necessary for the next steps where we use Visual Studio tooling to scaffold our CRUD controller and views for us.</p>

<h2>Package CRUD</h2>

<p>We now need to create the controller, actions, and views in order to create, read, update, and delete packages. To do this we will use Visual Studio tooling. This will make it super simple. The following 3 screenshots show what to do.</p>

<p>First, right click the <code>Controller</code> directory and choose <code>Add</code> followed by <code>Controller</code>.</p>

<p><img src="/images/algolia_csharp_04.png" alt="Screenshot 04" /></p>

<p>Next, choose <code>MVC 5 Controller with views, using Entity Framework</code>.</p>

<p><img src="/images/algolia_csharp_05.png" alt="Screenshot 05" /></p>

<p>Finally, be sure to choose the Package model we created for the <code>Model class</code>, the PackageTrackDbContext we created for the <code>Data context class</code>, check <code>Use async controller actions</code>, and set the <code>Controller name</code> to HomeController.</p>

<p><img src="/images/algolia_csharp_06.png" alt="Screenshot 06" /></p>

<p>Visual Studio should create a new HomeController along with a set of views. You can now build and run your project. You should be able to create, read, update, and delete packages. Go head and do this now and create a few packages. We will need them later.</p>

<h2>Build an Admin controller</h2>

<p>We now need to create an Admin controller that will provide us the ability to issue index, re-index, and delete commands to our Algolia index.</p>

<p>Inside the <code>Controllers</code> directory, create a file named <code>AdminController.cs</code>. Update it to contain the following code.</p>

<p>```c#
using Algolia.Search;
using PackageTrack.Web.Data;
using PackageTrack.Web.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using System.Web;
using System.Web.Mvc;</p>

<p>namespace PackageTrack.Web.Controllers
{</p>

<pre><code>public class AdminController : Controller
{
    private PackageTrackDbContext db = new PackageTrackDbContext();

    public ActionResult Index()
    {
        return View();
    }

    [HttpPost]
    [ValidateAntiForgeryToken]
    public async Task&lt;ActionResult&gt; ReIndexData()
    {
        return View();
    }

    [HttpPost]
    [ValidateAntiForgeryToken]
    public async Task&lt;ActionResult&gt; IndexData()
    {
        return View();
    }

    [HttpPost]
    [ValidateAntiForgeryToken]
    public async Task&lt;ActionResult&gt; DeleteData()
    {
        return View();
    }

    protected override void Dispose(bool disposing)
    {
        if (disposing)
        {
            db.Dispose();
        }
        base.Dispose(disposing);
    }
}
</code></pre>

<p>}
```</p>

<p>Inside the <code>Views</code> directory, create a new directory named <code>Admin</code>. Now that we have a new place for our admin views, create a new view there named <code>Index.cshml</code>. This is where we will setup our ability to issue index commands. Update the view with the following code.</p>

<p>```html</p>

<h2>Admin</h2>




<div>
    <hr />

    <div class="form-actions no-color">
        @using (Html.BeginForm("reindexdata", "admin"))
        {
            @Html.AntiForgeryToken()
            <input type="submit" value="Re-Index Data" class="btn btn-default" />
        }
        <br />
        @using (Html.BeginForm("indexdata", "admin"))
        {
            @Html.AntiForgeryToken()
            <input type="submit" value="Index Data" class="btn btn-default" />
        }
        <br />
        @using (Html.BeginForm("deletedata", "admin"))
        {
            @Html.AntiForgeryToken()
            <input type="submit" value="Delete Data" class="btn btn-default" />
        }
    </div>
</div>


<p>```</p>

<p>Now we need to create 3 views that can be used to show when our index commands have completed. Create the following views with their markup inside the <code>Views\Admin</code> directory.</p>

<p><strong>ReIndexData.cshtml</strong></p>

<p>```html</p>

<h2>Data Re-Indexed</h2>


<p>```</p>

<p><strong>IndexData.cshtml</strong></p>

<p>```html</p>

<h2>Data Indexed</h2>


<p>```</p>

<p><strong>DeleteData.cshtml</strong></p>

<p>```html</p>

<h2>Data Deleted</h2>


<p>```</p>

<h2>Algolia time</h2>

<p>Up to this point, we have been doing standard .NET development and nothing with Algolia (except adding the NuGet package). We are now ready to start.</p>

<p>Since our web application allows our users to create, update, and delete packages, we need to be able to do the same things to our Algolia index. On top of that, there are cases where we need to perform an index on all of our data, do a full re-index where data is removed and then added, and also remove all data from our index. We do all this from our web application rather than the Windows Phone application because it is much more secure to have our server talking to Algolia rather than each client. We don't want our credentials that allow changing index data to fall into a user's hand.</p>

<h3>Create reusable Algolia client</h3>

<p>The AlgoliaClient allows our application to easily interact with our Algolia index. In order to keep performance optimal, we don't want to create an instance of this client each time we need it. To address this, we will create one AlgoliaClient and store it in an Application Variable.</p>

<p>Let's go ahead and do this now.</p>

<p>Open up your <code>Global.asax.cs</code> file and update it as follows.</p>

<p>```c#
using Algolia.Search;
using PackageTrack.Web.Data;
using PackageTrack.Web.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Http;
using System.Web.Mvc;
using System.Web.Optimization;
using System.Web.Routing;</p>

<p>namespace PackageTrack.Web
{</p>

<pre><code>public class MvcApplication : System.Web.HttpApplication
{
    protected void Application_Start()
    {
        AreaRegistration.RegisterAllAreas();
        GlobalConfiguration.Configure(WebApiConfig.Register);
        FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);
        RouteConfig.RegisterRoutes(RouteTable.Routes);
        BundleConfig.RegisterBundles(BundleTable.Bundles);

        // Create our Algolia client
        var algoliaClient = new AlgoliaClient("&lt;APPLICATION_ID&gt;", "&lt;ADMIN_API_KEY&gt;");

        // Create our index helper
        var indexHelper = new IndexHelper&lt;Package&gt;(algoliaClient, "packages", "Id");

        // Store our index helper in an application variable.
        // We don't want to create a new one each time
        // because it will impact performance.
        Application.Add("PackageIndexHelper", indexHelper);
    }
}
</code></pre>

<p>}
```</p>

<p>What we are doing here is first creating an AlgoliaClient using our application id and key. You will need to update these two values using your own credentials. You can either use the Admin key already created for you or create your own key and choose the permissions allowed.</p>

<p>Next, we create an IndexHelper and inject our AlgoliaClient into it along with the name of the index and the value of our Package model identifier that should be mapped to the Algolia index object Id. The reason we want to specify the identifier in our model is because the IndexHelper will automatically build and  map our model to the Algolia index object.</p>

<p>Finally, we add our IndexHlper to the application variable so we can use it elsewhere in our application.</p>

<p>One thing to note is the index we are using in Algolia is called <code>packages</code>. You can either create it ahead of time or it will be automatically created when you issue index commands.</p>

<h3>Update our Admin controller to work with Algolia</h3>

<p>Now that we have an Algolia IndexHelper to use, we need to update our Admin controller to talk to Algolia when someone issues an indexing command.</p>

<p>Update each of the 3 following actions inside <code>AdminController.cs</code>. Make sure and add a using statement for Algolia.Search.</p>

<p>```c#
[HttpPost]
[ValidateAntiForgeryToken]
public async Task<ActionResult> ReIndexData()
{</p>

<pre><code>// Get the package index helper from Application variable
var packageIndexHelper = HttpContext.Application.Get("PackageIndexHelper") as IndexHelper&lt;Package&gt;;
await packageIndexHelper.OverwriteIndexAsync(db.Packages, 1000);

return View();
</code></pre>

<p>}</p>

<p>[HttpPost]
[ValidateAntiForgeryToken]
public async Task<ActionResult> IndexData()
{</p>

<pre><code>// Get the package index helper from Application variable
var packageIndexHelper = HttpContext.Application.Get("PackageIndexHelper") as IndexHelper&lt;Package&gt;;
await packageIndexHelper.SaveObjectsAsync(db.Packages, 1000);

return View();
</code></pre>

<p>}</p>

<p>[HttpPost]
[ValidateAntiForgeryToken]
public async Task<ActionResult> DeleteData()
{</p>

<pre><code>// Get the package index helper from Application variable
var packageIndexHelper = HttpContext.Application.Get("PackageIndexHelper") as IndexHelper&lt;Package&gt;;
await packageIndexHelper.DeleteObjectsAsync(db.Packages, 1000);

return View();
</code></pre>

<p>}
```</p>

<p>The IndexHelper is very nice. It will automatically handle the steps needed to perform indexing, re-indexing, and deleting of data. The way it works is it already knows the identifier to look for in your model so when you make an OverwriteIndex, SaveObjects, or DeleteObjects call it automatically converts your model to JSON, adds an objectId field, sets the objectId field to the identifier you told it to use, and makes the necessary calls to Algolia.</p>

<p>Now is a great time to test things out. You should already have packages in your database that are not in your Algolia index. Try out the different functions under the <code>/admin</code> path. You should see your index get populated, re-populated, and cleared out depending on which function you use.</p>

<h3>Update our CRUD to work with Algolia</h3>

<p>Having administrative ability to manage our index is great, but we really need to have our index kept up to date as users create, update, and delete packages from our database.</p>

<p>We will do this by updating the actions inside our Home controller we created earlier to support our CRUD operations on packages.</p>

<p>Update each of the 3 following actions inside <code>HomeController.cs</code>. Make sure and add a using statement for Algolia.Search.</p>

<p>```c#
[HttpPost]
[ValidateAntiForgeryToken]
public async Task<ActionResult> Create([Bind(Include = "Id,Name,Link,Count")] Package package)
{</p>

<pre><code>if (ModelState.IsValid)
{
    db.Packages.Add(package);
    await db.SaveChangesAsync();

    // Get the package index helper from Application variable
    var packageIndexHelper = HttpContext.Application.Get("PackageIndexHelper") as IndexHelper&lt;Package&gt;;
    await packageIndexHelper.SaveObjectAsync(package);

    return RedirectToAction("Index");
}

return View(package);
</code></pre>

<p>}</p>

<p>[HttpPost]
[ValidateAntiForgeryToken]
public async Task<ActionResult> Edit([Bind(Include = "Id,Name,Link,Count")] Package package)
{</p>

<pre><code>if (ModelState.IsValid)
{
    db.Entry(package).State = EntityState.Modified;
    await db.SaveChangesAsync();

    // Get the package index helper from Application variable
    var packageIndexHelper = HttpContext.Application.Get("PackageIndexHelper") as IndexHelper&lt;Package&gt;;
    await packageIndexHelper.SaveObjectAsync(package);

    return RedirectToAction("Index");
}
return View(package);
</code></pre>

<p>}</p>

<p>[HttpPost, ActionName("Delete")]
[ValidateAntiForgeryToken]
public async Task<ActionResult> DeleteConfirmed(int id)
{</p>

<pre><code>Package package = await db.Packages.FindAsync(id);
db.Packages.Remove(package);
await db.SaveChangesAsync();

// Get the package index helper from Application variable
var packageIndexHelper = HttpContext.Application.Get("PackageIndexHelper") as IndexHelper&lt;Package&gt;;
await packageIndexHelper.DeleteObjectAsync(package);

return RedirectToAction("Index");
</code></pre>

<p>}
```</p>

<p>What we did here was whenever a package is created, updated, or deleted, we use the IndexHelper to add, update, or remove the data within our index.</p>

<p>Go ahead and try it out.</p>

<h2>Implement real time search</h2>

<p>With all of our indexing in place, we are ready to add a real time search experience to our web application.</p>

<h3>Download JavaScript libraries</h3>

<p>We will need some JavaScript libraries in order to create the search feature. Download each of the following and save them in the <code>Scripts</code> directory with the names I indicate.</p>

<p><strong>typeahead.jquery.js</strong><br/>
<a href="https://cdn.jsdelivr.net/typeahead.js/0.10.5/typeahead.jquery.min.js">https://cdn.jsdelivr.net/typeahead.js/0.10.5/typeahead.jquery.min.js</a></p>

<p><strong>hogan.common.js</strong><br/>
<a href="https://cdn.jsdelivr.net/hogan.js/3.0.2/hogan.common.js">https://cdn.jsdelivr.net/hogan.js/3.0.2/hogan.common.js</a></p>

<p><strong>algoliasearch.min.js</strong><br/>
<a href="https://cdn.jsdelivr.net/algoliasearch/2.9/algoliasearch.min.js">https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js</a></p>

<h3>Bundle new JavaScript</h3>

<p>With the new scripts added to our project, we need to update our bundles to include them. Open up <code>\App_Start\BundleConfig.cs</code> and add the following new bundle.</p>

<p>```c#
bundles.Add(new ScriptBundle("~/bundles/main").Include(</p>

<pre><code>      "~/Scripts/typeahead.jquery.min.js",
      "~/Scripts/hogan.common.js",
      "~/Scripts/algoliasearch.min.js",
      "~/Scripts/main.js"));
</code></pre>

<p>```</p>

<h3>Update our layout</h3>

<p>Now we need to update our layout to include a search box and the new script bundle we created.</p>

<p>Open up <code>_Layout.cshtml</code> and modify the code as follows.</p>

<p>```html
....</p>

<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            @Html.ActionLink("Package Track", "Index", "Home", new { area = "" }, new { @class = "navbar-brand" })
        </div>
        <div class="typeahead-container">
            <input id="typeahead-algolia" class="typeahead" type="text" placeholder="Search...">
        </div>
    </div>
</div>


<p>...</p>

<p>@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")
@Scripts.Render("~/bundles/main")
@RenderSection("scripts", required: false)
```</p>

<h3>Create JavaScript to tie UI with Algolia</h3>

<p>The following code needs to be added to a new file named <code>main.js</code> within the <code>Scripts</code> directory. This sets us up to perform searches with our packages index on Algolia. Be sure to update the application id and key using your search only key.</p>

<p>```javascript
$(document).ready(function () {</p>

<pre><code>var client = algoliasearch('&lt;APPLICATION ID&gt;', '&lt;SEARCH-ONLY API KEY&gt;');
var index = client.initIndex('&lt;INDEX NAME&gt;');

var template = Hogan.compile(
    '&lt;a href="http://scottksmith.com/home/details/}"&gt;' +
        '&lt;div class="hit"&gt;' +
            '&lt;div class="name"&gt;' +
                '} ' +
            '&lt;/div&gt;' +
            '' +
            '&lt;div class="attribute"&gt;: }&lt;/div&gt;' +
            '' +
        '&lt;/div&gt;' +
    '&lt;/a&gt;');

$('#typeahead-algolia').typeahead({
    highlight: false,
    hint: true,
    minLength: 1
},
{
    source: index.ttAdapter({ "hitsPerPage": 10 }),
    displayKey: 'Name',
    templates: {
        suggestion: function (hit) {
            // select matching attributes only
            hit.attributes = [];
            for (var attribute in hit._highlightResult) {
                if (attribute === 'Name') {
                    // already handled by the template
                    continue;
                }
                // all others attributes that are matching should be added in the attributes array
                // so we can display them in the dropdown menu. Non-matching attributes are skipped.
                if (hit._highlightResult[attribute].matchLevel !== 'none') {
                    hit.attributes.push({ attribute: attribute, value: hit._highlightResult[attribute].value });
                }
            }

            // render the hit using Hogan.js
            return template.render(hit);
        }
    }
});
</code></pre>

<p>});
```</p>

<h3>Style the search</h3>

<p>Finally, we want to style our search. Add the following CSS to <code>\Content\Site.css</code>.</p>

<p>```css
.typeahead-container {</p>

<pre><code>float: right;
</code></pre>

<p>}</p>

<p>.typeahead {</p>

<pre><code>padding: 0 5px;
margin-top: 10px;
width: 300px;
height: 30px;
font-size: 14px;
line-height: 30px;
max-width: none;
</code></pre>

<p>}</p>

<p>.tt-input,
.tt-hint {</p>

<pre><code>width: 396px;
height: 30px;
padding: 8px 12px;
font-size: 14px;
line-height: 30px;
border: 2px solid #ccc;
border-radius: 8px;
outline: none;
</code></pre>

<p>}</p>

<p>.tt-input {</p>

<pre><code>box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
</code></pre>

<p>}</p>

<p>.tt-hint {</p>

<pre><code>color: #999;
</code></pre>

<p>}</p>

<p>.tt-dropdown-menu {</p>

<pre><code>width: 422px;
margin-top: 12px;
padding: 8px 0;
background-color: #fff;
border: 1px solid #ccc;
border: 1px solid rgba(0, 0, 0, 0.2);
border-radius: 8px;
box-shadow: 0 5px 10px rgba(0,0,0,.2);
</code></pre>

<p>}</p>

<p>.tt-suggestion {</p>

<pre><code>padding: 3px 20px;
font-size: 14px;
line-height: 24px;
</code></pre>

<p>}</p>

<pre><code>.tt-suggestion.tt-cursor {
    color: #fff;
    background-color: #0097cf;
}

.tt-suggestion p {
    margin: 0;
}

.tt-suggestion em {
    font-weight: bold;
    font-style: normal;
}
</code></pre>

<p>.name {</p>

<pre><code>font-weight: bold;
</code></pre>

<p>}</p>

<p>.attribute {</p>

<pre><code>margin-left: 10px;
</code></pre>

<p>}
```</p>

<p>If you would like to get a more in depth tutorial on the real time search piece we just added, you can read other articles I wrote here.</p>

<p><a href="http://scottksmith.com/blog/2014/10/21/getting-started-with-algolia-real-time-search/">http://scottksmith.com/blog/2014/10/21/getting-started-with-algolia-real-time-search/</a></p>

<p><a href="http://scottksmith.com/blog/2014/10/29/algolia-real-time-search-with-twitters-typeaheadjs/">http://scottksmith.com/blog/2014/10/29/algolia-real-time-search-with-twitters-typeaheadjs/</a></p>

<h2>Create REST API for packages</h2>

<p>The last thing we need to do in our web application is to build a REST based API for our package information. This will be used by our Windows Phone application.</p>

<p>First, create a new directory within the <code>Controllers</code> directory and name it <code>Api</code>.</p>

<p>Right click on the Api folder and choose <code>Add</code> followed by <code>Controller</code>. Follow the next few screenshots to see what settings to use and values to set.</p>

<p><img src="/images/algolia_csharp_07.png" alt="Screenshot 07" /></p>

<p><img src="/images/algolia_csharp_08.png" alt="Screenshot 08" /></p>

<p><img src="/images/algolia_csharp_09.png" alt="Screenshot 09" /></p>

<p>Because we want to only return JSON even when the request header is not <code>application/json</code> we need to update our <code>WebApiConfig.cs</code> file in the <code>App_Start</code> directory.</p>

<p>```c#
using System.Net.Http.Headers;</p>

<p>  ...</p>

<p>  config.Formatters.JsonFormatter.SupportedMediaTypes.Add(new MediaTypeHeaderValue("text/html"));
```</p>

<p>We are now ready to create our Windows Phone application that will perform searches using Algolia and show data from our web application.</p>

<h2>Create a new Windows Phone Application</h2>

<p>In our current solution, create a new project and choose <code>Blank App (Windows Phone)</code>. You can name it whatever you like, but I went with PackageTrack.Phone.</p>

<p><img src="/images/algolia_csharp_10.png" alt="Screenshot 10" /></p>

<h2>Install necessary NuGet package</h2>

<p>This application requires one new package in order to work.</p>

<p><strong>Algolia Search</strong></p>

<p>Install the Algolia Search package. The version used in this tutorial is 3.0.5.</p>

<p><code>tcsh
PM&gt; Install-Package Algolia.Search
</code></p>

<h2>Configure startup projects</h2>

<p>In order for both applications to work, we need to configure our solution to start the web and phone application when we build and run. The following screenshots show how to do this.</p>

<p><img src="/images/algolia_csharp_11.png" alt="Screenshot 11" /></p>

<p><img src="/images/algolia_csharp_12.png" alt="Screenshot 12" /></p>

<p>Debug or run your applications now to make sure both projects start.</p>

<h2>Build our application UI</h2>

<p>Now that our project and solution are ready to go, we can add some components to our application to build out our UI.</p>

<p>If <code>MainPage.xaml</code> is not open, you will want to open it now. This will load the designer view. The next two steps and screenshots show the two components we want to add to our view. Just drag each of the components from the Toolbox within Visual Studio into your UI as shown below.</p>

<h3>Add AutoSuggestBox</h3>

<p><img src="/images/algolia_csharp_13.png" alt="Screenshot 13" /></p>

<h3>Add WebView</h3>

<p><img src="/images/algolia_csharp_14.png" alt="Screenshot 14" /></p>

<p><img src="/images/algolia_csharp_15.png" alt="Screenshot 15" /></p>

<h3>Configure WebView</h3>

<p>We need to give our WebView a name so we can reference it within our code. You will need to name it <code>SearchWebView</code>. The following code shows the updated XAML for this change.</p>

<p><code>xml
&lt;WebView Name="SearchWebView" HorizontalAlignment="Left" Height="576" Margin="10,54,0,0" VerticalAlignment="Top" Width="380"/&gt;
</code></p>

<h3>Configure AutoSuggestBox events</h3>

<p>Our AutoSuggestBox is where the user will start typing a search query and will be responsible for searching our index on Algolia. We need to setup two events to handle when the text changes and when a suggestion is selected.</p>

<p>Update the MainPage XAML to the following for the AutoSuggestBox.</p>

<p><code>xml
&lt;AutoSuggestBox HorizontalAlignment="Left" Margin="10,10,0,0" VerticalAlignment="Top" Width="380" TextChanged="AutoSuggestBox_TextChanged" SuggestionChosen="AutoSuggestBox_SuggestionChosen"/&gt;
</code></p>

<p>When adding new event handlers in this fashion, the code behind is automatically created in <code>MainPage.xaml.cs</code>. If they are not there, be sure to add them as follows.</p>

<p>```c#
private void AutoSuggestBox_TextChanged(AutoSuggestBox sender, AutoSuggestBoxTextChangedEventArgs args)
{</p>

<p>}</p>

<p>private void AutoSuggestBox_SuggestionChosen(AutoSuggestBox sender, AutoSuggestBoxSuggestionChosenEventArgs args)
{</p>

<p>}
```</p>

<h2>Add Algolia to our application</h2>

<p>If you don't have <code>MainPage.xaml.cs</code> open, open it now.</p>

<p>We are going to add the necessary code to add Algolia search capabilities to our application.</p>

<p>The first thing we need is to add two private members to our MainPage class. These will be an AlgoliaClient and Index.</p>

<p><code>c#
private AlgoliaClient algoliaClient = null;
private Index algoliaIndex = null;
</code></p>

<p>Next, we need to instantiate these objects within the constructor. Be sure to change the application id and search only key to the ones you used in the web project.</p>

<p>```c#
public MainPage()
{</p>

<pre><code>this.InitializeComponent();

this.NavigationCacheMode = NavigationCacheMode.Required;

algoliaClient = new AlgoliaClient("&lt;APPLICATION_ID&gt;", "&lt;SEARCH_ONLY_API_KEY&gt;");
algoliaIndex = algoliaClient.InitIndex("packages");
</code></pre>

<p>}
```</p>

<p>Finally, be sure to add the necessary using statement.</p>

<p><code>c#
using Algolia.Search;
</code></p>

<h2>Tie it all together</h2>

<p>We now need to create a class that can be used to deserialize the Algolia search responses. Inside <code>MainPage.xaml.cs</code> create the following class. You will notice it defines Name, Link, Count, and objectID. The first 3 are fields we defined in our web application. The last one is the ID that Algolia uses in its indexed data. This is the field we mapped our models ID field to.</p>

<p>Also, you will see we are overriding <code>ToString()</code>. This is because we will be adding each <code>Hit</code> object to our AutoSuggestBox and want to control how the data is shown.</p>

<p>```c#
private class PackagesResult
{</p>

<pre><code>public class Hit
{
    public string Name { get; set; }
    public string Link { get; set; }
    public string Count { get; set; }
    public string objectID { get; set; }

    public override string ToString()
    {
        return Name + Environment.NewLine +
            "  Link:\t" + Link + Environment.NewLine +
            "  Count:\t" + Count;
    }
}

public List&lt;Hit&gt; hits { get; set; }
</code></pre>

<p>}
```</p>

<p>Next we need to implement our search code each time a user enters a character in our AutoSuggestBox. Update the AutoSuggestBox event handler for TextChanged as follows.</p>

<p>```c#
private void AutoSuggestBox_TextChanged(AutoSuggestBox sender, AutoSuggestBoxTextChangedEventArgs args)
{</p>

<pre><code>if (args.Reason == AutoSuggestionBoxTextChangeReason.UserInput)
{
    var searchTerm = sender.Text;
    var query = new Query(searchTerm);
    var result = algoliaIndex.SearchAsync(query).Result;
    var packagesResult = result.ToObject&lt;PackagesResult&gt;();

    sender.ItemsSource = packagesResult.hits;
}
</code></pre>

<p>}
```</p>

<p>What we are doing here is creating a new Algolia Query using the entered text. We then issue a search, get back the results as JSON, and convert it to a PackagesResult object. The last thing we do is add the list of Hits as the ItemsSource of our AutoSuggestBox. This will automatically show the results to the user.</p>

<p>Finally, we need to update the SuggestionChosen event for our AutoSuggestBox when a user selects one of the results we showed them. Update it as follows.</p>

<p>```c#
private void AutoSuggestBox_SuggestionChosen(AutoSuggestBox sender, AutoSuggestBoxSuggestionChosenEventArgs args)
{</p>

<pre><code>var hit = (PackagesResult.Hit)args.SelectedItem;
SearchWebView.Navigate(new Uri("http://localhost:8671/api/packages/" + hit.objectID));
</code></pre>

<p>}
```</p>

<p>All we are doing here is taking the selected item, reference that items object ID, and then navigating our WebView to that page. The page we are showing is the API endpoint we created in our web application. This is just a simple example of how to tie the two applications together. A more robust approach would be to process the data from the API and build a UI capable of viewing, editing, and deleting the data.</p>

<p><img src="/images/algolia_csharp_16.png" alt="Screenshot 16" /></p>

<h3>Wrap up</h3>

<p>That wraps up this tutorial on adding Algolia to an ASP.NET MVC application along with a Windows Phone 8.1 application. There was a lot going on here, but if you take out the standard stuff for our web and phone application, the Algolia part is very simple and straightforward.</p>

<p>If you found this article or others useful be sure to <a href="http://scottksmith.com/atom.xml">subscribe to my RSS feed</a> or <a href="https://twitter.com/scottksmith95">follow me on Twitter</a>. Also, if there are certain topics you would like me to write on, feel free to leave comments and let me know.</p>

<p>Source code for tutorial can be found <a href="https://github.com/algolia/tutorials/tree/master/csharp/src/PackageTrack">here on GitHub</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Deeper dive into ScriptCS]]></title>
    <link href="http://scottksmith.com/blog/2013/05/14/deeper-dive-into-scriptcs/"/>
    <updated>2013-05-14T10:33:00-07:00</updated>
    <id>http://scottksmith.com/blog/2013/05/14/deeper-dive-into-scriptcs</id>
    <content type="html"><![CDATA[<p>Welcome to part 2 of the ScriptCS series</p>

<ol>
<li><a href="/blog/2013/05/08/getting-started-with-scriptcs/">Getting started with ScriptCS</a></li>
<li><a href="/blog/2013/05/14/deeper-dive-into-scriptcs/">Deeper dive into ScriptCS</a></li>
</ol>


<h2>Introduction</h2>

<p>In this article, we will be exploring the newish REPL interactive mode, script packs, and many other cool features of ScriptCS.</p>

<p>ScriptCS allows you to use C# as a scripting language. It harnesses the power of <a href="http://msdn.microsoft.com/en-us/vstudio/roslyn.aspx">Roslyn</a> and <a href="http://nuget.org/">NuGet</a> to enable you to write .NET applications with your favorite editor.</p>

<p>If you are new to ScriptCS, I'd like to suggest reading my previous article <a href="/blog/2013/05/08/getting-started-with-scriptcs/">Getting started with ScriptCS</a> to learn more about how to install and use it.</p>

<!-- more -->


<h2>REPL</h2>

<p><a href="http://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a> (Read, Eval, Print, Loop) is now supported in the latest release of ScriptCS.</p>

<p>Using REPL with ScriptCS can be done by running ScriptCS without any parameters and allows you to run C# statements from the command prompt without the neeed for files, editors, etc.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ scriptcs
</span><span class='line'>scriptcs (ctrl-c or blank to exit)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;p>var name = "Scott";
</span><span class='line'>var location = "California";
</span><span class='line'>Console.WriteLine(name + " lives in " + location);
</span><span class='line'>Scott lives in California</span></code></pre></td></tr></table></div></figure></notextile></div></p></blockquote>

<p>When you run ScriptCS in REPL mode, you will see some help output on the screen indicating how to end the session. This can be done using Ctrl+C or pressing Enter with no input.</p>

<h2>Script Packs</h2>

<p>Script packs offer a great way to extend ScriptCS. They provide developers a way to create and share their own extensions for consumption by others using ScriptCS. The current list of available script packs can be found on the <a href="https://github.com/scriptcs/scriptcs/wiki/Script-Packs-master-list">ScriptCS Wiki</a>.</p>

<p>Script packs will work in both normal execution and interactive REPL mode.</p>

<p>Adding a script pack to your project can be done in a few ways but the simplest and best option is to use the ScriptCS install directive. You can read about more ways to install packages on the <a href="https://github.com/scriptcs/scriptcs/wiki/Package-installation">GitHub Wiki</a>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scriptcs -install ScriptCs.WebApi</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>In this example, we are using ScriptCS to install the package ScriptCs.WebApi into our current directory. This will pull down the assemblies from NuGet, place them in the packages and bin folders, and update packages.config.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scriptcs -install ScriptCs.WebApi
</span><span class='line'>INFO : Installing packages...
</span><span class='line'>INFO : Installed: ScriptCs.WebApi
</span><span class='line'>INFO : Installation completed successfully.
</span><span class='line'>INFO : Copying assemblies to bin folder...
</span><span class='line'>INFO : Copied: System.Net.Http.Formatting.dll.
</span><span class='line'>INFO : Copied: System.Web.Http.dll.
</span><span class='line'>INFO : Copied: System.Web.Http.SelfHost.dll.
</span><span class='line'>INFO : Copied: System.Net.Http.dll.
</span><span class='line'>INFO : Copied: System.Net.Http.WebRequest.dll.
</span><span class='line'>INFO : Copied: Newtonsoft.Json.dll.
</span><span class='line'>INFO : Copied: ScriptCs.Contracts.dll.
</span><span class='line'>INFO : Copied: ScriptCs.WebApi.Pack.dll.
</span><span class='line'>INFO : Restore completed successfully.
</span><span class='line'>Initiated saving packages into packages.config...
</span><span class='line'>Added Microsoft.AspNet.WebApi.Client, Version 4.0.20710.0, .NET 4.0
</span><span class='line'>Added Microsoft.AspNet.WebApi.Core, Version 4.0.20710.0, .NET 4.0
</span><span class='line'>Added Microsoft.AspNet.WebApi.SelfHost, Version 4.0.20918.0, .NET 4.0
</span><span class='line'>Added Microsoft.Net.Http, Version 2.0.20710.0, .NET 4.5
</span><span class='line'>Added Newtonsoft.Json, Version 4.5.11, .NET 4.0
</span><span class='line'>Added ScriptCs.Contracts, Version 0.3.2, .NET 4.5
</span><span class='line'>Added ScriptCs.WebApi, Version 0.1.0, .NET 4.5
</span><span class='line'>Packages.config successfully created!</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Now that the package is installed, we can import it into our script by using <code>Require&lt;T&gt;()</code>. That is the beauty of script packs. They simplify the usage of other functionality that may otherwise be complex.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var webApi = Require&lt;WebApi>();</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>With the inclusion of the WebApi script pack you can actually fire up a working Web API host. Try it out by running the following commands in interactive mode and then browsing to <a href="http://localhost:8888">localhost:8888</a>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scriptcs&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;p>var webApi = Require&lt;WebApi>();
</span><span class='line'>var server = webApi.CreateServer("http://localhost:8888");
</span><span class='line'>server.OpenAsync().Wait();</span></code></pre></td></tr></table></div></figure></notextile></div></p></blockquote>

<p>To shut the server down make sure to run</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;p>server.CloseAsync().Wait();</span></code></pre></td></tr></table></div></figure></notextile></div></p></blockquote>

<p>You may have noticed when you browsed to localhost:8888 the response indicated "No HTTP resource was found that matches the request URI 'http://localhost:8888/'". This means we have not yet defined any controllers. To do this we will take advantage of of the <code>#load</code> directive supported by ScriptCS. In your project directory where  you installed the ScriptCs.WebApi script pack, create a new script called Controllers.csx with the following code:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ScriptCSController</span> <span class="p">:</span> <span class="n">ApiController</span> <span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">public</span> <span class="kt">string</span> <span class="n">Get</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;Thanks for using ScriptCS!&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>This code defines a ScriptCS controller that ScriptCs.WebApi will automatically detect and load when loaded via the <code>Require&lt;T&gt;()</code> command.</p>

<p>In order to use this newly created script we will need to reference it using the <code>#load</code> directive. The <code>#load</code> directive is used to reference other scripts from within your script or interactive session. It must be placed at the top of a script otherwise it will be ignored. Also, you can use both relative and absolute paths.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scriptcs&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;h1>load "Controllers.csx";&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>var webApi = Require&lt;WebApi>();
</span><span class='line'>var server = webApi.CreateServer("http://localhost:8888");
</span><span class='line'>server.OpenAsync().Wait();</span></code></pre></td></tr></table></div></figure></notextile></div></p></blockquote>

<p>Now when you browse to <a href="http://localhost:8888/ScriptCS">localhost:8888/ScriptCS</a> you will see the response message "Thanks for using ScriptCS!". Finally, don't forget to shut the server down like we did before.</p>

<p>Another directive worth mentioning is <code>#r</code>. This directive is used to explicitly reference assemblies within the GAC or your local bin folder. If you have added assemblies via the <code>scriptcs -install</code> or <code>scriptcs -restore</code> commands you do not need to use the <code>#r</code> directive. It is used for including other assemblies.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>r "MyCustomAssembly.dll"&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Building a Script Pack</h2>

<p>Rather than reinvent the wheel, I will refer to a great blog post by Martin Doms on <a href="http://blog.martindoms.com/2013/05/14/building-scriptcs-script-pack/">Building a scriptcs script pack</a>.</p>

<h2>ClrMD</h2>

<p>ClrMD, <a href="https://nuget.org/packages/Microsoft.Diagnostics.Runtime">Microsoft.Diagnostics.Runtime component</a>, is a set of advanced APIs for programmatically inspecting a crash dump of a .NET program and performing live process inspection. It allows you to write automated crash analysis for your applications and automate many common debugger tasks.</p>

<p>This is a fabulous fit for the scriptable nature of ScriptCS. Using ScriptCS and ClrMD we have an environment where we can interactively debug and inspect .NET programs and processes.</p>

<p>There are currently two projects in very early stages attempting to create script packs for ClrMD.</p>

<p><a href="https://github.com/pwalat/ScriptCs.ClrDiagnostics">ScriptCs.ClrDiagnostics</a><br/>
<a href="https://github.com/hackedbrain/scriptcs.clrmd">ScriptCs.ClrMD</a></p>

<p>I would highly suggest taking a look at both.</p>

<h2>Summary</h2>

<p>ScriptCS is already a very powerful, flexible, and user friendly environment for working with C# as a scripting language. It takes advantage of an elegant language, incorporates Roslyn, and utilizes NuGet to provide scriptable C#, REPL, and Script Packs. I am personally looking forward to what will be coming next.</p>

<p>Thanks for reading.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting started with ScriptCS]]></title>
    <link href="http://scottksmith.com/blog/2013/05/08/getting-started-with-scriptcs/"/>
    <updated>2013-05-08T07:58:00-07:00</updated>
    <id>http://scottksmith.com/blog/2013/05/08/getting-started-with-scriptcs</id>
    <content type="html"><![CDATA[<p>Welcome to part 1 of the ScriptCS series</p>

<ol>
<li><a href="/blog/2013/05/08/getting-started-with-scriptcs/">Getting started with ScriptCS</a></li>
<li><a href="/blog/2013/05/14/deeper-dive-into-scriptcs/">Deeper dive into ScriptCS</a></li>
</ol>


<h2>So what is ScriptCS?</h2>

<p>ScriptCS allows you to use C# as a scripting language. It harnesses the power of <a href="http://msdn.microsoft.com/en-us/vstudio/roslyn.aspx">Roslyn</a> and <a href="http://nuget.org/">NuGet</a> to enable you to write .NET applications with your favorite editor.</p>

<p>ScriptCS allows you to do something like this:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>copy con Sample.csx
</span><span class='line'>var x = 2;
</span><span class='line'>var y = 3;
</span><span class='line'>var z = x * y;
</span><span class='line'>Console.WriteLine(z);&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>scriptcs Sample.csx
</span><span class='line'>6</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<!-- more -->


<p>ScriptCS also offers its own REPL providing an interactive experience. You can install nuget packages, type some code, and have it execute instantly! As of writing this post, this functionality is in the dev branch and not yet available on the master branch. If you want learn more, head over to this <a href="http://codebetter.com/glennblock/2013/05/07/scriptcs-gets-a-repl/">blog post</a>.</p>

<h2>Installation</h2>

<p>There are two ways to install ScriptCS:</p>

<ul>
<li>Get the source from <a href="https://github.com/scriptcs/scriptcs">GitHub</a>, build it, and add scriptcs.exe to your path</li>
<li>Use <a href="http://chocolatey.org/">Chocolatey</a> to download and install it automatically</li>
</ul>


<p>For simplicity, we will be using the Chocolatey Nuget method of installation. Copy and paste the following command into your console. This will execute a PowerShell script that will download Chocolatey, place it on your local drive, and configure your path. Make sure to reload your session so your new path is loaded.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="nv">@powershell</span> <span class="n">-NoProfile</span> <span class="n">-ExecutionPolicy</span> <span class="n">unrestricted</span> <span class="n">-Command</span> <span class="s2">&quot;iex ((new-object net.webclient).DownloadString(&#39;https://chocolatey.org/install.ps1&#39;))&quot;</span> <span class="p">&amp;</span><span class="n">amp</span><span class="err">;</span><span class="p">&amp;</span><span class="n">amp</span><span class="err">;</span> <span class="n">SET</span> <span class="n">PATH</span><span class="p">=</span><span class="k">%</span><span class="n">PATH</span><span class="p">%</span><span class="err">;</span><span class="k">%</span><span class="n">systemdrive</span><span class="p">%\</span><span class="n">chocolatey</span><span class="p">\</span><span class="n">bin</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Next execute the following command in your console. This will download ScriptCS, place it on your local drive, and configure your path. Make sure to reload your session again so your new path is loaded.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="n">cinst</span> <span class="n">scriptcs</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Note: If you are uncomfortable running these commands found on some random blog, you can either go to the Chocolatey site for installation instructions or get the ScriptCS source and build it yourself. Don't worry, I won't be offended.</p>

<h2>Exploring one of the samples</h2>

<p>We will be exploring the RavenDB sample.</p>

<p>First, we need to get the samples from GitHub. The easiest way is to clone the repo:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/scriptcs/scriptcs-samples.git</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Change into the directory scriptcs-samples/ravendb. If you look in this directory you will notice there is a packages.config file. This file defines the packages dependencies for this sample. Since we do not have the packages yet (no packages directory) we need to get them. This is done by executing the command <code>scriptcs -install</code>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ scriptcs -install
</span><span class='line'>Installing packages...
</span><span class='line'>Installed: RavenDB.Embedded 2.0.2261.0
</span><span class='line'>Installation completed successfully.
</span><span class='line'>Copying assemblies to bin folder...
</span><span class='line'>Copied: Raven.Client.Embedded.dll.
</span><span class='line'>Copied: Esent.Interop.dll.
</span><span class='line'>Copied: GeoAPI.dll.
</span><span class='line'>Copied: ICSharpCode.NRefactory.CSharp.dll.
</span><span class='line'>Copied: ICSharpCode.NRefactory.dll.
</span><span class='line'>Copied: Jint.Raven.dll.
</span><span class='line'>Copied: Lucene.Net.Contrib.FastVectorHighlighter.dll.
</span><span class='line'>Copied: Lucene.Net.Contrib.Spatial.NTS.dll.
</span><span class='line'>Copied: Lucene.Net.dll.
</span><span class='line'>Copied: Mono.Cecil.dll.
</span><span class='line'>Copied: NetTopologySuite.dll.
</span><span class='line'>Copied: PowerCollections.dll.
</span><span class='line'>Copied: Raven.Abstractions.dll.
</span><span class='line'>Copied: Raven.Database.dll.
</span><span class='line'>Copied: Spatial4n.Core.NTS.dll.
</span><span class='line'>Copied: Raven.Abstractions.dll.
</span><span class='line'>Copied: Raven.Client.Lightweight.dll.
</span><span class='line'>Restore completed successfully.</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>This will instruct NuGet to download all the packages defined in the packages.config. Now that we have all the necessary packages, we can run the sample with <code>scriptcs start.csx</code>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ scriptcs start.csx
</span><span class='line'>Found assembly reference: Esent.Interop.dll
</span><span class='line'>Found assembly reference: GeoAPI.dll
</span><span class='line'>Found assembly reference: ICSharpCode.NRefactory.CSharp.dll
</span><span class='line'>Found assembly reference: ICSharpCode.NRefactory.dll
</span><span class='line'>Found assembly reference: Jint.Raven.dll
</span><span class='line'>Found assembly reference: Lucene.Net.Contrib.FastVectorHighlighter.dll
</span><span class='line'>Found assembly reference: Lucene.Net.Contrib.Spatial.NTS.dll
</span><span class='line'>Found assembly reference: Lucene.Net.dll
</span><span class='line'>Found assembly reference: Mono.Cecil.dll
</span><span class='line'>Found assembly reference: NetTopologySuite.dll
</span><span class='line'>Found assembly reference: PowerCollections.dll
</span><span class='line'>Found assembly reference: Raven.Abstractions.dll
</span><span class='line'>Found assembly reference: Raven.Client.Embedded.dll
</span><span class='line'>Found assembly reference: Raven.Client.Lightweight.dll
</span><span class='line'>Found assembly reference: Raven.Database.dll
</span><span class='line'>Found assembly reference: Spatial4n.Core.NTS.dll
</span><span class='line'>Starting RavenDB Server, Please Be Patient...
</span><span class='line'>RavenDB Started, Listening On http://localhost:8080</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Just like that we have RavenDB started and listing on port 8080.</p>

<h2>Write our own</h2>

<p>Let's get our environment setup to create our own example. Create a directory and name it whatever you want. We will call ours Sample. Change into the newly created directory and create a file called Start.csx. Open this file in whatever editor you want to and enter the following code:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http.SelfHost</span><span class="p">;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="kt">var</span> <span class="n">address</span> <span class="p">=</span> <span class="s">&quot;http://localhost:8080&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kt">var</span> <span class="n">conf</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpSelfHostConfiguration</span><span class="p">(</span><span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="n">address</span><span class="p">));</span>
</span><span class='line'><span class="n">conf</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="n">MapHttpRoute</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;DefaultApi&quot;</span><span class="p">,</span>
</span><span class='line'>   <span class="n">routeTemplate</span><span class="p">:</span> <span class="s">&quot;api/{controller}/{id}&quot;</span><span class="p">,</span>
</span><span class='line'>   <span class="n">defaults</span><span class="p">:</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">RouteParameter</span><span class="p">.</span><span class="n">Optional</span> <span class="p">}</span>
</span><span class='line'><span class="p">);&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="kt">var</span> <span class="n">server</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpSelfHostServer</span><span class="p">(</span><span class="n">conf</span><span class="p">);</span>
</span><span class='line'><span class="n">server</span><span class="p">.</span><span class="n">OpenAsync</span><span class="p">().</span><span class="n">Wait</span><span class="p">();</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Listening...&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>You may notice we have references to System.Web.Http and System.Web.Http.SelfHost but those assemblies are not currently available. Try it out and see for yourself by running the command <code>scriptcs Start.csx</code>. The error you are receiving is because those assemblies are not available. To install them we need to execute the command <code>scriptcs -install Microsoft.AspNet.WebApi.SelfHost</code>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scriptcs -install Microsoft.AspNet.WebApi.SelfHost
</span><span class='line'>Installing packages...
</span><span class='line'>Installed: Microsoft.AspNet.WebApi.SelfHost
</span><span class='line'>Installation completed successfully.
</span><span class='line'>Copying assemblies to bin folder...
</span><span class='line'>Copied: System.Net.Http.Formatting.dll.
</span><span class='line'>Copied: System.Web.Http.dll.
</span><span class='line'>Copied: System.Web.Http.SelfHost.dll.
</span><span class='line'>Copied: System.Net.Http.dll.
</span><span class='line'>Copied: System.Net.Http.WebRequest.dll.
</span><span class='line'>Copied: Newtonsoft.Json.dll.
</span><span class='line'>Restore completed successfully.
</span><span class='line'>Initiated saving packages into packages.config...
</span><span class='line'>Added Microsoft.AspNet.WebApi.Client, Version 4.0.20710.0, .NET 4.0
</span><span class='line'>Added Microsoft.AspNet.WebApi.Core, Version 4.0.20710.0, .NET 4.0
</span><span class='line'>Added Microsoft.AspNet.WebApi.SelfHost, Version 4.0.20918.0, .NET 4.0
</span><span class='line'>Added Microsoft.Net.Http, Version 2.0.20710.0, .NET 4.5
</span><span class='line'>Added Newtonsoft.Json, Version 4.5.11, .NET 4.0
</span><span class='line'>Packages.config successfully created!</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Now that we have the required assemblies available, run the command <code>scriptcs Start.csx</code>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scriptcs start.csx
</span><span class='line'>Found assembly reference: Newtonsoft.Json.dll
</span><span class='line'>Found assembly reference: System.Net.Http.dll
</span><span class='line'>Found assembly reference: System.Net.Http.Formatting.dll
</span><span class='line'>Found assembly reference: System.Net.Http.WebRequest.dll
</span><span class='line'>Found assembly reference: System.Web.Http.dll
</span><span class='line'>Found assembly reference: System.Web.Http.SelfHost.dll
</span><span class='line'>Listening...</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>If you open up your browser and navigate to http://localhost:8080 you should see that our ScriptCS program is running and listening for connections on port 8080.</p>

<h2>Sublime Text 2</h2>

<p>There is a <a href="https://github.com/scriptcs/scriptcs-sublime">Sublime Text 2 package</a> available to turn on syntax highlighting for CSX files. You can either install it manually via git or via the Package Control Plugin.</p>

<h4>Package Control Plugin</h4>

<p>The easiest way is to install the package is using the Package Control Plugin.</p>

<p><img src="/images/package-control-plugin.png" alt="Package Control Plugin" /></p>

<h4>Git</h4>

<p>To install manually using git, go to your packages directory and run the command:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/scriptcs/scriptcs-sublime.git</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>If you want to update the scriptcs-sublime package, simply run this command from inside the scriptcs-sublime directory:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git pull origin master</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Along with syntax highlighting, the package will also provide a build system. To build, use Cmd+B on Mac or Ctrl+B on Windows. If you encounter any compilation errors, you can hit F4 to navigate to the error.</p>

<h2>Summary</h2>

<p>ScriptCS offers some great functionality for those wanting to experience C# as a scripting language. With the power of Roslyn and NuGet, ScriptCS is poised to become a very powerful tool.</p>

<h2>Resources</h2>

<p><a href="http://scriptcs.net/">Project site</a><br/>
<a href="https://github.com/scriptcs/scriptcs">GitHub repository</a><br/>
<a href="https://github.com/scriptcs/scriptcs-samples">Official examples</a><br/>
<a href="https://github.com/scriptcs/scriptcs-sublime">Sublime Text 2 package</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using @ and _ with HTML Helpers in Razor Views]]></title>
    <link href="http://scottksmith.com/blog/2013/05/07/using-at-and-with-html-helpers-in-razor-views/"/>
    <updated>2013-05-07T11:38:00-07:00</updated>
    <id>http://scottksmith.com/blog/2013/05/07/using-at-and-with-html-helpers-in-razor-views</id>
    <content type="html"><![CDATA[<p>Here is a tip for you .NET developers.</p>




<p>When you are using HTML helpers there are times when you need to add extra attributes to the HTML element being produced by the helper. Two attributes that are commonly added are the class and data- attribute. HTML helpers support the ability to pass in an anonymous object for setting these attributes. The helper will take each item out of the anonymous object and add them to the html element as attributes.</p>




<!-- more -->




<p>Here is simple example that sets the id of the checkbox element:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">@Html</span><span class="p">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="s">&quot;1&quot;</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>This works just fine when things are simple, but what if you want to set the class attribute? If you were to try the following, it would fail:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="err">@</span><span class="n">@Html</span><span class="p">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="k">class</span> <span class="err">= &quot;</span><span class="nc">bananas</span><span class="s">&quot; })</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The reason this fails is because class is a reserved keyword in C#. The way to get around this to preface the keyword with @ which tells the C# compiler to treat the word as a symbol.</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="err">@</span><span class="n">@Html</span><span class="p">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">@class</span> <span class="p">=</span> <span class="s">&quot;bananas&quot;</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Now, say you want to add a data-name attribute to the element. If you were to create like the following, it would fail:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="err">@</span><span class="n">@Html</span><span class="p">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">@class</span> <span class="p">=</span> <span class="s">&quot;bananas&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">-</span><span class="n">name</span> <span class="p">=</span> <span class="s">&quot;bit&quot;</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The reason this fails is because the C# compiler does not allow dashes (-) in variable names. Not to worry though, this is easily handled by using the underscore (_) character in place of the dash. The underscore will be automatically replaced with a dash at run time.</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="err">@</span><span class="n">@Html</span><span class="p">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">@class</span> <span class="p">=</span> <span class="s">&quot;bananas&quot;</span><span class="p">,</span> <span class="n">data_name</span> <span class="p">=</span> <span class="s">&quot;bit&quot;</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>So the final output would look like this:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;bananas&quot;</span> <span class="na">data-name=</span><span class="s">&quot;bit&quot;</span> <span class="na">id=</span><span class="s">&quot;ignore&quot;</span> <span class="na">name=</span><span class="s">&quot;ignore&quot;</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SignalR: Awesome Real-Time with .NET - Part 2]]></title>
    <link href="http://scottksmith.com/blog/2012/10/31/signalr-awesome-real-time-with-net-part-2/"/>
    <updated>2012-10-31T14:59:00-07:00</updated>
    <id>http://scottksmith.com/blog/2012/10/31/signalr-awesome-real-time-with-net-part-2</id>
    <content type="html"><![CDATA[<p>Welcome to part two of the seriesSignalR: Awesome Real-Time with .NET.</p>

<p>Part 1 - <a href="http://scottksmith95.wordpress.com/2012/10/30/signalr-awesome-real-time-with-net/">SignalR: Awesome Real-Time with .NET</a></p>

<p>Part 2 - SignalR: Awesome Real-Time with .NET- Part 2</p>

<p>For this post, we will start where we left off from part one. If you don't want to follow part one and create the solution, project, code, etc, you can get the source on <a href="https://github.com/scottksmith95/SignalRTutorial">GitHub</a>.</p>

<p><strong>Step 1 - Specifying the route for the Hub</strong></p>

<p>Because Hubs are at a higher level than PersistentConnections, there is no need to manually set the route for the Hub. Some of the magic I talked about before does this for us automatically by creating the route /SignalR. To change the route for the Hub you need to register the route in the Global.asax file and update any client side references to the Hub.</p>

<!-- more -->


<p>Update Global.asax to change the route to /SignalR2</p>

<pre>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Http;
using System.Web.Mvc;
using System.Web.Routing;
using SignalR;

namespace SignalRTutorial
{
    // Note: For instructions on enabling IIS6 or IIS7 classic mode, 
    // visit http://go.microsoft.com/?LinkId=9394801
    public class MvcApplication : System.Web.HttpApplication
    {
        protected void Application_Start()
        {
            RouteTable.Routes.MapHubs("~/SignalR2");

            AreaRegistration.RegisterAllAreas();

            WebApiConfig.Register(GlobalConfiguration.Configuration);
            FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);
            RouteConfig.RegisterRoutes(RouteTable.Routes);
        }
    }
}</pre>


<p>Update your client side code in Index.cshtml to use the new route</p>

<pre>&lt;script src="http://scottksmith.com/SignalR2/Hubs"&gt;&lt;/script&gt;</pre>


<p><strong>Step 2 - Specifying the name of the Hub</strong></p>

<p>Another thing that is done automatically is the name of the Hub itself. By default, the name we use client side to reference the Hub is the same as the Type of the Hub. In our code, this is TagHub which we reference with</p>

<pre>$.connection.tagHub;</pre>


<p>If we want to change it to something else, we only have to decorate our TagHub class with theHubName attribute.</p>

<p>Decorate the TagHub class in TagHub.cs with the HubName attribute using tagHub as our name.</p>

<pre>[HubName("ourTagHub")]
public class TagHub : Hub</pre>


<p>Because we changed the name of our Hub, we also need to update our reference to this Hub client side.</p>

<p>Update your client side code in Index.cshtml to reference the new Hub name</p>

<pre>var tagHub = $.connection.ourTagHub;</pre>


<p><strong>Step 3 - Detecting connects and reconnects</strong></p>

<p>It is pretty straightforward to detect connects and reconnects in your Hub. All you have to do is implement IConnected on your Hub. There are two functions that need to be implemented, Connect and Reconnect. Update your TagHub class by implementing IConnected.</p>

<pre>using System.Collections.Generic;
using System.Threading.Tasks;
using SignalR.Hubs;

namespace SignalRTutorial.Hubs
{
    [HubName("ourTagHub")]
    public class TagHub : Hub, IConnected
    {
        static List _tags = new List();

        static TagHub()
        {
            _tags.Add("c#");
            _tags.Add(".NET");
            _tags.Add("SignalR");
        }

        public void getTags()
        {
            //Call the initTags method on the calling client
            Caller.initTags(_tags);
        }

        public void setTag(string tag)
        {
            //Add the new tag to the list of tags
            _tags.Add(tag);

            //Call the addTag method on all connected clients
            Clients.addTag(tag);
        }

        public Task Connect()
        {
            return Clients.joined(Context.ConnectionId);
        }

        public Task Reconnect(IEnumerable groups)
        {
            return Clients.rejoined(Context.ConnectionId);
        }
    }
}</pre>


<p>As you can see, the Connect and Reconnect methods are making calls to all of our connected clients. Before we implement the client side code to support these calls, I want to point out Context.ConnectionId. Context.ConnectionId is the unique id assigned to the current connection and caller. The Caller property we used before to access the caller is the same thing as Clients[Context.ConnectionId]. The Context.ConnectionId is something that can be stored and used to access connections later.</p>

<p>Here is the client side code needed to support the two new calls being made by our Hub. First add the following markup as the first element inside the &lt;body&gt; tag.</p>

<pre>&lt;div style="float: right"&gt;
    &lt;ul id="connections"&gt;&lt;/ul&gt;
&lt;/div&gt;</pre>


<p>Next add these two methods just below the tagHub.addTag method.</p>

<pre>tagHub.joined = function (connectionId) {
    $('#connections').append('&lt;li&gt;Connect: ' + connectionId + '&lt;/li&gt;');
}

tagHub.rejoined = function (connectionId) {
    $('#connections').append('&lt;li&gt;Reconnect: ' + connectionId + '&lt;/li&gt;');
}</pre>


<p><strong>Step 4 - Detecting disconnects</strong></p>

<p>Detecting disconnects is very similar to how we detected connects. This time we need to implement IDisconnect on our Hub and the method Disconnect.</p>

<p>First implementIDisconnect on your TagHub class and then add the following method.</p>

<pre>public class TagHub : Hub, IConnected, IDisconnect
{

    public Task Disconnect()
    {
        return Clients.leave(Context.ConnectionId);
    }

}</pre>


<p>Next you will need to update the client side code and add the following method.</p>

<pre>tagHub.leave = function (connectionId) {
    $('#connections').append('&lt;li&gt;Disconnect: ' + connectionId + '&lt;/li&gt;');
}</pre>


<p><strong>Step 5 - State between client and server</strong></p>

<p>It is very easy to maintain state between the client and server. Any state sent by the client can be accessed by the server Hub via the Caller property. The server Hub can also set state that will be accessible by the client by setting any property on Caller. In our application you would do this by setting any property you want client side on thetagHub variable such as tagHub.name = 'scott';. You would then be able to access this server side in our Hub with Caller.name. You can also create a new property server side by using the Caller property doing something like Caller.isCool = 'true';.</p>

<p><strong>Step 6 - Broadcasting over a Hub outside of a Hub</strong></p>

<p>There may be cases where you want to broadcast over a Hub from outside of the Hub itself. One example would be an action on a controller you want to be able to broadcast to all connected clients when it is called.</p>

<p>Update the HomeController with the following code.</p>

<pre>using SignalR;
using SignalRTutorial.Hubs;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace SignalRTutorial.Controllers
{
    public class HomeController : Controller
    {
        //
        // GET: /Home/

        public ActionResult Index()
        {
            return View();
        }

        public void Notify()
        {
            var context = GlobalHost.ConnectionManager.GetHubContext&lt;TagHub&gt;();
            context.Clients.addTag("notify called");
        }
    }
}</pre>


<p>The newly created Notify action on the Home controller gets the context to our TagHub. With this context we can now make calls to the clients via the Caller or Clients property.</p>

<p><strong>Conclusion</strong></p>

<p>That is it for now! Stayed tuned for part 3.</p>

<p>The final source code can be found<a href="https://github.com/scottksmith95/SignalRTutorial-Part2">GitHub</a>.</p>

<p><strong>Further reading</strong></p>

<p><a href="https://github.com/SignalR/SignalR/wiki">SignalR official documentation
</a></p>

<p><a href="http://www.codeproject.com/Articles/322154/ASP-NET-MVC-SIngalR-and-Knockout-based-Real-time-U">ASP.NET MVC, SignalR and Knockout...</a></p>

<p><a href="http://www.d80.co.uk/post/2011/10/21/SignalR.aspx">signalr tutorial with knockoutjs</a></p>

<p><a href="http://www.bradygaster.com/testing-signalr-connections-with-nunit">Testing SignalR Connections with NUnit</a></p>
]]></content>
  </entry>
  
</feed>
